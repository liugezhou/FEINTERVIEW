## 29 | HTTP/1：HTTP 性能优化

### 超文本传输协议 HTTP/0.9

> HTTP/0.9 是在 1991 年提出。
> 主要用于学术交流-在网络之间传递 HTML 超文本内容，所以被称为**超文本传输协议(HyperText Transfer Protocol)**。  
> 过程是：客户端根据 IP 地址、端口号和服务器建立 TCP 连接，建立连接后，发送一个 GET 请求行消息来获取 html，服务器接收到这个 Get 请求，将数据以 **ASCII 字符流**返回给客户端，html 传输完成，断开连接。  
> 特点是：只有一个请求行，没有 HTTP 请求头和请求体；服务器也没有返回头信息，只有返回的数据；返回的文件内容是以 ASCII 字符流来传输的。 
> 
> 关键词：1991年、学术交流、Get、超文本内容、ASCII

### 被浏览器推动的 HTTP/1.0

> 新兴网络的发展，浏览器需要展示的内容不单单是 HTML 文件，还有 JS、CSS、图片、音频、视频等不同类型的文件，也就是说 HTTP1.0 的核心诉求就是要**支持多种类型的文件下载**，且文件格式不再局限于 ASCII 编码了。  
> 为了满足多种类型文件的传输，HTTP/1.0 引入了**请求头和响应头**。  
> 请求头的内容有：服务器返回的文件类型、文件压缩方式、提供什么语言文件、文件的具体编码：

```
accept: text/html
accept-encoding: gzip, deflate, br
accept-Charset: ISO-8859-1,utf-8
accept-language: zh-CN,zh
```

> 除了对多文件的增强外，还根据实际需求引入了几个新增的典型特性：
>
> - 引入了**状态码 **
> - 为了减轻服务器压力，HTTP/1.0 提供了 Cache 机制，用来缓存下载过的数据
> - 在请求头中加入了**用户代理**的字段(为了统计客户端的信息--比如Windows和MacOS用户数量为多少)

### 缝缝补补的HTTP/1.1

#### 改进持久性连接
> 一个页面可能包含几百个外部资源文件，为了解决每次下载都需要建立TCP连接，HTTP/1.1中增加了持久性连接的方法，特点是可以在一个TCP连接上传输多个HTTP请求，只要浏览器或者服务器没有明确断开连接，那么持久性连接就会使得该TCP连接一直保持。   
> 然后，这么做就减少了服务器的负担，提升了HTTP的请求时长，他的持久性连接是默认开启的，如果想关闭通过Connection:close。  
> 目前，浏览器对于同一个域名，默认允许建立6个TCP持久连接。  
> 如果想增加TCP的连接，可以使用一种叫做**域名分片**的技术：把该站点下面的资源放在多个域名下。

#### 不成熟的HTTP管线化
> 如果TCP通道中的某个请求因为某些原因没有及时返回，那就会阻塞后面的所有请求，这就是著名的队头阻塞问题。 
> HTTP/1.1使用了管线化技术，但是不成熟。  
> HTTP/1.1的管线化技术是将多个HTTP请求整批发送给服务器的技术。虽然整批发送了请求，但是服务器依然需要根据请求顺序来回复浏览器的请求。

#### 提供虚拟主机的支持
> 随着虚拟主机发展，一台主机可以绑定多个虚拟主机，每个虚拟主机都可以有自己的单独域名。  
> 于是，HTTP/1.1的请求头中添加了Host字段，用来表示当前的域名地址。

#### 对动态生成的内容提供了完美支持
> 在HTTP/1.0那会，浏览器根据响应头中设置的服务器告诉的数据大小来进行数据的接收，但随着服务器端发展，服务器返回的内容为动态生成，也就在传输数据的时候不知道最终的数据大小是多少，这个时候浏览器也就不知道到底接收多少数据。  
> 于是，HTTP/1.1引入了**Chunk transfer**机制，服务器将数据分割成任意大小的数据块，每个数据块发送时会附上上个数据的长度，最后一个使用零长度来作为发送数据完成的标志，于是也就提供了对动态内容的支持。

#### 客户端Cookire、安全机制
> 添加Cookie。

> 总结就是，HTTP/1.1增加了持久性连接、添加了Host字段、Chunk transfer机制、Cookie、解决队头阻塞问题使用用不成熟的管线化技术。

## 30｜HTTP/2：如何提升网络速度？
### HTTP/1.1的主要问题
> HTTP/1.1的核心问题是：对宽带的利用率不理想。  
> 宽带是指每秒最大能发送或者接收的字节数，我们把每秒能发送的最大字节数称为**上行宽带**，每秒能接受的最大字节数称为**下行宽带**。出现宽带利用率的问题，主要有三个原因导致：    
> - TCP的慢启动：慢启动是TCP为减少网络阻塞的一种策略，我们无法改变。  
> - 开启了多条TCP连接，那么这些连接会竞争固定的宽带,会影响关键资源的下载速度。  
> - HTTP/1.1的队头阻塞问题:持久化连接可以共用一个通道，且同一时刻只能处理一个请求，请求没结束前，其它请求只能处于阻塞状态。

### HTTP/2的多路复用
> 针对HTTP/1.1的问题，由于TCP我们换不掉，所以只能针对TCP慢启动和TCP连接之间的宽带利用下手。    
> HTTP/2的解决思路是一个域名只使用一个**TCP长连接**来传输数据，这样整个页面的资源下载只需要一次慢启动，且避免了多个TCP连接竞争宽带的问题。  
> 另外，针对队头阻塞问题，请求完一个请求再去发送另一个请求无疑是非常慢的，所以HTTP/2需要实现**资源的并行请求**：也就是任何时候都可以将请求发送给服务器。  
> 
> 一句话总结HTTP/2为：一个域名只使用一个TCP长连接和解决队头阻塞问题。 也就是最具颠覆性的**多路复用机制**。  
> 
